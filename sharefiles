#!/usr/bin/env bash
# (produced by GPT-5) for sharing files
# Concatenate all files listed by `git ls-files`, each wrapped in a fenced
# code block with a guessed language, preceded by repo metadata.
# Usage: ./concat-files.sh > repo-dump.txt

set -euo pipefail
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8
{
# Print repository metadata to help the assistant orient diffs/patches.
echo "=== Repo meta ==="
git rev-parse --show-toplevel 2>/dev/null || true
echo "HEAD: $(git rev-parse --short HEAD 2>/dev/null || echo 'unknown')"
echo "DESC: $(git describe --tags --always 2>/dev/null || echo 'n/a')"
echo "Status:"
git status --porcelain=v1 2>/dev/null || true
echo "Files:"
git ls-files
echo "================="

# Emit all tracked files with fenced code blocks and basic language tagging.
while IFS= read -r f; do
  echo "$f"
  case "$f" in
    *.swift) lang="swift" ;;
    *.yml|*.yaml) lang="yaml" ;;
    *.md) lang="md" ;;
    *.json) lang="json" ;;
    *.sh) lang="bash" ;;
    *.plist) lang="xml" ;;
    *) lang="" ;;
  esac
  if [[ -n "$lang" ]]; then
    echo '```'"$lang"
  else
    echo '```'
  fi
  cat "$f"
  echo '```'
done < <(git ls-files)
} | pbcopy
echo "Files copied to clipboard"
